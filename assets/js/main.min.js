var isLegales =
  window.location.href.indexOf("politicas") != -1 ||
  window.location.href.indexOf("terminos") != -1;
if (isLegales) {
  initPage();
}
if (window.innerWidth <= 1000) {
  setTimeout(function () {
    $("body,html").animate({ scrollTop: 0 }, 0);
  }, 500);
}
$(document).ready(function () {
  var $container = $("body");
  var imageCount = $container.find(".load-img").length;
  var loadedImageCount = 0;
  var percentage = 0;
  var timesLoaded = 0;
  var $progress = $(".loader-progress-bar");
  var r = $progress.attr("r");
  var c = Math.PI * (r * 2);
  $("#faqs .question .title").click(function () {
    if ($(this).hasClass("active")) {
    } else {
      $("#faqs .question .text").slideUp();
      $("#faqs .question .title").removeClass("active");
      $(this).next().slideDown();
      $(this).addClass("active");
    }
  });
  $("#faqs .question:first-child .title").click();
  if (!isLegales) {
    TweenMax.to(".loader-circle", 1.5, {
      ease: Elastic.easeOut.config(1, 0.5),
      scale: 1,
    });
    TweenMax.to(".loader-progress", 1.5, {
      ease: Elastic.easeOut.config(1, 0.5),
      scale: 1,
      delay: 0.1,
    });
    $container.imagesLoaded({ background: ".load-img" }).progress(function () {
      ++loadedImageCount;
      var newPerc = (loadedImageCount * 100) / imageCount;
      if (newPerc > 90) newPerc = 100;
      var i = percentage;
      var interval1 = setInterval(function () {
        if (i <= newPerc) {
          if (parseInt($("#percentage").text()) < i) {
            $("#percentage").text(parseInt(i) + "%");
            var pct = ((100 - i) / 100) * c;
            $progress.css({ strokeDashoffset: pct });
          }
          i += Math.floor(Math.random() * 5) + 1;
        } else {
          clearInterval(interval1);
          if (i >= 100) {
            $("#percentage").text("100%");
            var pct = ((100 - 100) / 100) * c;
            $progress.css({ strokeDashoffset: pct });
            showPage();
          }
        }
      }, 150);
    });
    function showPage() {
      if (timesLoaded == 0) {
        timesLoaded = 1;
        TweenMax.to(".loader-circle", 1, {
          ease: Elastic.easeIn.config(1, 0.7),
          scale: 0,
          opacity: 0,
          delay: 0.1,
        });
        TweenMax.to(".loader-progress", 1, {
          ease: Elastic.easeIn.config(1, 0.7),
          scale: 0,
          opacity: 0,
        });
        initPage();
      }
    }
  }
});
function initPage() {
  var top = 380;
  if (window.innerWidth <= 1000) top = 310;
  if (!isLegales) {
    TweenMax.to("#main-card", 3, {
      top: top,
      opacity: 1,
      left: 0,
      delay: 2,
      ease: Elastic.easeOut.config(1, 0.5),
    });
    TweenMax.to(".phone-hero img", 3, {
      top: 0,
      opacity: 1,
      rotation: 0,
      delay: 2,
      ease: Elastic.easeOut.config(1, 0.5),
    });
    var height;
    if (window.location.href.indexOf("beneficios") != -1) {
      height = $("#verbs").offset().top + $("#verbs").outerHeight() - 580;
      setSlickActions();
    } else {
      height =
        $("#beneficios").offset().top + $("#beneficios").outerHeight() - 600;
    }
    $("#main-card-fixed").css("height", parseInt(height));
    setTimeout(function () {
      TweenMax.to("#hero .bg-elements img", 4, {
        y: 0,
        x: 0,
        opacity: 1,
        ease: Expo.easeOut,
        delay: 0.2,
      });
      setTimeout(function () {
        $("body").addClass("loaded");
        $("#hero .show-words").addClass("show");
      }, 0);
      TweenMax.to(".bottom-fixed", 2, { bottom: 0, ease: Expo.easeOut });
      setTimeout(function () {
        TweenMax.to(".scroll-down-wrap", 1.5, {
          y: 0,
          opacity: 1,
          ease: Expo.easeOut,
        });
        TweenMax.to(".by-visa", 1.5, {
          y: 0,
          opacity: 1,
          delay: 0.5,
          ease: Expo.easeOut,
        });
      }, 2000);
    }, 3000);
    setSlick();
  } else {
    $("body").addClass("loaded");
  }
  bindWindowResize();
  setWordChange();
  bindInputTel();
  if (window.innerWidth > 1000) {
    initScroll();
  } else {
    bindScrollMobile();
    hideHeader();
  }
  $('a[href]:not([target="_blank"])').click(function (e) {
    e.preventDefault();
    var href = $(this).attr("href");
    $(".page-transition").addClass("show");
    setTimeout(function () {
      window.location.href = href;
    }, 500);
  });
}
function bindInputTel() {
  $(".input input").focus(function () {
    $(this).parent().addClass("focus");
  });
  $(".input input").blur(function () {
    $(this).parent().removeClass("focus");
  });
  $(".input input").keydown(function () {
    if (/\D/g.test(this.value)) this.value = this.value.replace(/\D/g, "");
  });
}
function bindWindowResize() {
  var lastSize = window.innerWidth;
  $(window).resize(function () {
    if (window.innerWidth > 1000) window.location.reload();
  });
}
function setWordChange() {
  var index = 2;
  setInterval(function () {
    if (document.hasFocus()) {
      var $last = $(".verbs span.active");
      var $lastBg = $("#hero .bg-word span.active");
      var $target = $('.verbs span[data-id="' + index + '"]');
      var $targetBg = $('#hero .bg-word span[data-id="' + index + '"]');
      $lastBg.removeClass("active");
      $targetBg.addClass("active");
      TweenMax.fromTo($last, 0.7, { top: -3 }, { ease: Expo.easeOut, top: 15 });
      TweenMax.fromTo(
        $target,
        0.7,
        { top: -15 },
        {
          top: -3,
          ease: Expo.easeOut,
          delay: 0.2,
          onComplete: function () {
            $last.removeClass("active");
            $target.addClass("active");
          },
        }
      );
      if (index < 5) {
        ++index;
      } else {
        index = 1;
      }
    }
  }, 2000);
}
function setSlick() {
  $("#obten-slide").slick({
    slidesToShow: 1,
    arrows: !1,
    dots: !0,
    infinite: !1,
  });
  $("#obten-slide").on("beforeChange", function (
    event,
    slick,
    currentSlide,
    next
  ) {
    $("#obten-slide").attr("data-id-selected", next);
  });
  $("#obten-slide .slick-slide").click(function () {
    var i = $(this).index();
    $("#obten-slide").slick("slickGoTo", i);
  });
  $("#obten-arrows .arrow-left").click(function () {
    $("#obten-slide").slick("slickPrev");
  });
  $("#obten-arrows .arrow-right").click(function () {
    $("#obten-slide").slick("slickNext");
  });
  $("#obten-slide").on("afterChange", function (evt, slick, current) {
    if (current == 3) {
      $("#obten-slide").slick("slickGoTo", 0);
    }
  });
}
function initScroll() {
  setTimeout(function () {
    var scroll = new LocomotiveScroll({
      el: document.querySelector("#js-scroll"),
      smooth: !0,
    });
    var $screen1 = $("#screens");
    var $screen2 = $("#screen-2");
    var $screen3 = $("#screen-3");
    var $screen4 = $("#screen-4");
    var $screen5 = $("#screen-5");
    var $screen6 = $("#screen-6");
    var $screen7 = $("#screen-7");
    var $screen8 = $("#screen-8");
    var $beneficios = $("#beneficios");
    var $atributos = $("#atributos");
    var $download = $("#download");
    var $comercio = $("#comercio");
    var $registrate = $("#registrate");
    var $obten = $("#obten");
    var $verbs = $("#verbs");
    var $beneficiosCirlce = $("#beneficios-circles");
    var lastScroll = 0;
    scroll.on("scroll", function (func) {
      if (window.location.href.indexOf("beneficios") == -1) {
        if (func.scroll.y > 150) {
          $(".wrap-card").addClass("no-rotate");
        } else {
          $(".wrap-card").removeClass("no-rotate");
        }
      }
      if ($screen1.hasClass("is-inview")) {
        $(".screen-content, .screen-text").removeClass("active");
        $(".sc2").addClass("active");
      } else {
        $(".screen-content, .screen-text").removeClass("active");
      }
      if ($screen2.hasClass("is-inview")) {
        $(".screen-content, .screen-text").removeClass("active");
        $(".sc3").addClass("active");
      }
      if ($screen3.hasClass("is-inview")) {
        $(".screen-content, .screen-text").removeClass("active");
        $(".sc4").addClass("active");
      }
      if ($screen4.hasClass("is-inview")) {
        $(".screen-content, .screen-text").removeClass("active");
        $(".sc5").addClass("active");
      }
      if ($screen5.hasClass("is-inview")) {
        $(".screen-content, .screen-text").removeClass("active");
        $(".sc6").addClass("active");
      }
      if (
        $screen6.hasClass("is-inview") ||
        $screen7.hasClass("is-inview") ||
        $beneficios.hasClass("is-inview")
      ) {
        $(".screen-content, .screen-text").removeClass("active");
        $(".sc7").addClass("active");
      }
      if (
        $registrate.hasClass("is-inview") ||
        $download.hasClass("is-inview") ||
        $comercio.hasClass("is-inview")
      ) {
        $(".bottom-fixed").addClass("hide");
      } else {
        $(".bottom-fixed").removeClass("hide");
      }
      if (
        window.location.href.indexOf("beneficios") != -1 &&
        $download.hasClass("is-inview")
      ) {
        $("#main-card").addClass("hide");
      } else {
        $("#main-card").removeClass("hide");
      }
      if (
        ($(".screen-container").hasClass("is-inview") &&
          !$beneficios.hasClass("is-inview")) ||
        $("#elements-out").hasClass("is-inview")
      ) {
        $("#hero .bg-elements").removeClass("hide");
      } else {
        $("#hero .bg-elements").addClass("hide");
      }
      if ($beneficiosCirlce.hasClass("is-inview")) {
        $("#main-card").addClass("down");
      } else {
        $("#main-card").removeClass("down");
      }
      if (func.scroll.y > 300) {
        $("#fixed-header").addClass("fixed");
        if (lastScroll > func.scroll.y) {
          $("#fixed-header").addClass("show-scroll");
        } else {
          $("#fixed-header").removeClass("show-scroll");
        }
      } else {
        $("#fixed-header").removeClass("show-scroll");
      }
      lastScroll = func.scroll.y;
    });
    $("#beneficios .button, .beneficios-button").click(function () {
      scroll.scrollTo("#beneficios", -100);
      $("header .toggle-nav, header nav").removeClass("active");
      $("header").removeClass("show-nav");
    });
    $(".scroll-down-wrap").click(function () {
      $("#hero .bg-elements").addClass("hide");
      setTimeout(function () {
        var off = 100;
        if (window.location.href.indexOf("beneficios") != -1) off = -100;
        scroll.scrollTo("#verbs", off);
      }, 500);
    });
    $(".underlined[data-link]").click(function () {
      scroll.scrollTo("#" + $(this).data("link"), -100);
    });
    $("#click-faqs-diferencia").click(function () {
      scroll.scrollTo("#faqs", 500);
    });
    $(".click-goto-sms").click(function () {
      scroll.scrollTo("#registrate", -200);
    });
    if (window.location.href.indexOf("download") != -1) {
      setTimeout(function () {
        scroll.scrollTo("#registrate", -200);
      }, 5000);
    }
  }, 100);
}
function bindScrollMobile() {
  var controller = new ScrollMagic.Controller();
  var showArray = [];
  $(".show-me").each(function (i, v) {
    var $self = $(this);
    var id = "#" + $self.attr("id");
    showArray[i] = new ScrollMagic.Scene({
      triggerElement: id,
      duration: $self.outerHeight(),
      offset: $self.data("offset"),
    }).addTo(controller);
    showArray[i].on("enter", function () {
      $self.addClass("is-inview");
    });
    showArray[i].on("leave", function () {});
  });
  new ScrollMagic.Scene({
    triggerElement: "#beneficios",
    duration: $("#beneficios").outerHeight() + 800,
  })
    .setTween(".logos .row:first-child > div", { x: -500 })
    .addTo(controller);
  new ScrollMagic.Scene({
    triggerElement: "#beneficios",
    duration: $("#beneficios").outerHeight() + 800,
  })
    .setTween(".logos .row:nth-child(2) > div", { x: 500 })
    .addTo(controller);
  new ScrollMagic.Scene({
    triggerElement: "#beneficios",
    duration: $("#beneficios").outerHeight() + 800,
  })
    .setTween(".logos .row:last-child > div", { x: -500 })
    .addTo(controller);
  new ScrollMagic.Scene({
    triggerElement: "#verbs",
    duration: $("#verbs").outerHeight() + 800,
  })
    .setTween("#verbs .line:first-child span", { x: -500 })
    .addTo(controller);
  new ScrollMagic.Scene({
    triggerElement: "#verbs",
    duration: $("#verbs").outerHeight() + 800,
  })
    .setTween("#verbs .line:last-child span", { x: 500 })
    .addTo(controller);
  $(".click-faqs-diferencia").click(function () {
    $("body, html").animate({ scrollTop: $("#faqs").offset().top }, 700);
  });
  $(".click-goto-sms").click(function () {
    $("body, html").animate(
      { scrollTop: $("#registrate").offset().top - 100 },
      700
    );
  });
  if (window.location.href.indexOf("download") != -1) {
    setTimeout(function () {
      $("body, html").animate(
        { scrollTop: $("#registrate").offset().top - 100 },
        700
      );
    }, 3000);
  }
}
function hideHeader() {
  $("#fixed-header").addClass("fixed show-scroll hide-shadow");
  var didScroll;
  var lastScrollTop = 0;
  var delta = 5;
  var navbarHeight = $("header").outerHeight();
  $(window).scroll(function (event) {
    hasScrolled();
  });
  function hasScrolled() {
    var st = $(this).scrollTop();
    if (Math.abs(lastScrollTop - st) <= delta) return;
    if (st > lastScrollTop) {
      $("#fixed-header").removeClass("show-scroll hide-shadow");
      $("header .toggle-nav, header nav").removeClass("active");
      $("header").removeClass("show-nav");
    } else {
      $("#fixed-header").addClass("show-scroll");
    }
    if (st <= 50) {
      $("#fixed-header").addClass("show-scroll hide-shadow");
    }
    lastScrollTop = st;
  }
  $(".bottom-fixed .mobile i").click(function () {
    TweenMax.to(".bottom-fixed", 1, { bottom: -170, ease: Expo.easeOut });
    $("#comercio").addClass("no-padding");
  });
  $("header .toggle-nav").click(function () {
    $("header .toggle-nav, header nav").toggleClass("active");
    $("header").toggleClass("show-nav");
  });
  $("#beneficios .button, .beneficios-button").click(function () {
    $("html,body").animate({ scrollTop: $("#beneficios").offset().top - 50 });
    $("header .toggle-nav, header nav").removeClass("active");
    $("header").removeClass("show-nav");
  });
}
var cantAgoras = 100;
function setSlickActions() {
  var phoneX = $(".phone-hero img")[0].getBoundingClientRect().x + 100;
  setInterval(function () {
    $(".actions-circles .action").each(function () {
      if ($(this)[0].getBoundingClientRect().x >= phoneX) {
        $(this).find(".active").show();
        if ($(this).attr("data-flagged") == "0") {
          modifyAgoras(parseInt($(this).attr("data-agoras")));
          $(this).attr("data-flagged", "1");
        }
      } else {
        $(this).find(".active").hide();
        $(this).attr("data-flagged", "0");
      }
    });
  }, 100);
}
function modifyAgoras(cant) {
  cantAgoras += cant;
  $("#agoras-cant").addClass("change");
  $("#agoras-cant span").text(cantAgoras);
  setTimeout(function () {
    $("#agoras-cant").removeClass("change");
  }, 300);
}
